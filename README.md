# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта:

Проект представляет собой интернет-магазин для веб-разработчиков под названием "Веб-ларек". Это место, где пользователи
могут:

Просматривать широкий ассортимент товаров, предназначенных для веб-разработки.

Добавлять товары в корзину для удобства дальнейшей покупки.

Оформлять заказы и совершать покупки через удобный интерфейс.

## Архитектура проекта (MVC):

Архитектура MVC помогает разделить ответственность между слоями и делает код более поддерживаемым и тестируемым.

## Описание базовых классов:

## -------------------
Класс AModel. Родительский класс

***Поля***:
Не имеет.

***Конструктор***:
Создает экземпляр базовой модели.
Принимает событие типа IEvents.

***Методы***:
- `emitChanges`- Принимает параметром событие event типа string и payload типа object(необязательный. Если не передам будет использоваться пустой объект).Генерирует событие.

## -------------------
**Класс Api**

Базовый класс для работы с REST API. Поддерживает GET-запросы и POST/PUT/DELETE-запросы с отправкой данных.

***Поля***:

- `baseUrl` - Базовый URL, к которому будут добавляться относительные URI, типа string.
- `options` - Типа RequestInit. Объект с параметрами по умолчанию для всех запросов. Автоматически устанавливает заголовок 'Content-Type': 'application/json'.

***Конструктор***:
Принимает в параметры базовый URL для всех запросов: baseUrl типа string. И options: необязательный объект конфигурации типа RequestInit.

***Методы***:
- `handleResponse(response: Response): Promise<T>`- Внутренний метод: обработчик ответа сервера. Принимает параметром response типа Response — объект ответа, полученный от fetch. Возвращает Promise<T> — успешный результат или ошибка
- `get(uri: string)`- принимает изменяющеюся часть url-адреса uri типа string, возвращает ответ от сервера.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')`- принимает изменяющеюся часть url-адреса,
  принимает данные в виде объекта для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'..

***Типы***:
- `ApiListResponse<Type>`
Универсальный тип ответа для списков:

{
total: number;
items: Type[];
}

- `ApiPostMethods`
Допустимые HTTP-методы: 'POST' | 'PUT' | 'DELETE'

## -------------------

**Класс AView**

Обеспечивает базовые методы для работы с DOM и логику обновления UI на основе данных.
Наследуется другими вьюшками, которые реализуют собственную отрисовку через doRender.

***Поля***:

- `data: Partial<RenderData>` - Внутреннее хранилище данных, используемых для рендеринга.
- `container: HTMLElement` - Контейнер DOM-элемента, к которому привязано представление.

***Конструктор***:
Создаёт экземпляр представления, привязывая его к указанному DOM-элементу.
Принимает параметром container: HTMLElement — DOM-элемент, в котором происходит отрисовка.


***Методы***:
- `render(data: Partial<RenderData>): HTMLElement` - Объединяет переданные данные с текущими, вызывает метод doRender и возвращает DOM-элемент.
  Используется для обновления UI.

- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` - Добавляет или убирает CSS-класс на DOM-элементе.
 Принимает параметрами: element — DOM-элемент, className — название класса, force — явное указание: добавить (true) или убрать (false) класс.

- `setText(element: HTMLElement, value: unknown): void` - Устанавливает текстовое содержимое элемента.
  Принимает параметрами: element — DOM-элемент, value — текст (любого типа, преобразуется в строку).

- `setDisabled(element: HTMLElement, state: boolean): void` - Блокирует или разблокирует элемент формы.
  Параметры: element — DOM-элемент, state — true, если нужно заблокировать.
- 
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` - Устанавливает src и alt для изображения.
  Параметры: element — DOM-изображение, src — ссылка на изображение, alt — альтернативный текст (необязательно).

- `doRender(data: Partial<RenderData>): void` - Абстрактный метод. Выполняет отрисовку представления по данным.


## -------------------



Класс **EventEmitter** реализует паттерн «Observer/Наблюдатель» и обеспечивает работу событий, его методы позволяют
устанавливать и снимать слушатели событий, вызвать слушатели при возникновении события.

***Поля***:
- `_events: Map<EventName, Set<Subscriber>>` - Хранилище всех подписчиков. Каждому имени события соответствует набор его обработчиков (функций).

***Конструктор***:
Создаёт пустой список событий. Инициализирует _events.

***Методы***:
- `on<T>(event: EventName, callback: (data: T) => void): void` - Подписывает обработчик на конкретное событие. 
Параметрами принимает event: string | RegExp — имя события или регулярное выражение и callback: (data: T) => void — функция, вызываемая при срабатывании события.

- `off(event: EventName, callback: Subscriber): void` - для отписки от события. Параметрами принимает event: string | RegExp — имя события или регулярное выражение
и callback: Function — ранее добавленный обработчик.

- `emit<T>(event: string, data?: T): void` - уведомления подписчиков о наступлении события. Параметрами принимает event: string — имя события
и data: T (необязательное) — данные, передаваемые обработчикам.
- 
- `onAll(callback: (event: EmitterEvent) => void): void` - Для подписки на все события. Парметры: callback: (event: { eventName: string, data: unknown }) => void.
- `offAll(): void` - Для сброса всех подписчиков.
- `trigger<T>(event: string, context?: Partial<T>): (data: T) => void` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика
  события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса
  EventEmitter. Параметрами принимает event: string — имя события и context: Partial<T> (необязательно) — дополнительные данные, объединяемые с data. Возвращает (data: T) => void — колбэк, который можно передать как обработчик в UI-компоненты

## Описание данных (Интерфейсы):

**Интерфейс Контракта API-клиента для взаимодействия с сервером магазина ILarekApi**

***Методы***:
- `getProductItem`- загружает товара с сервера по id. Возвращает объект Product.
- `getProductList`- загружает список всех товаров с сервера. Возвращает массив объектов Product[].
- `orderProducts`- Отправляет успешный заказ на сервер. Принимает объект order типа IOrder. Возвращает результат заказа типа OrderResult.


**Интерфейс данных корзины IBasketData**. 
Данные, которые посылаются вместе с событием basketEvents.CHANGED.

***Поля***:
- `products`: Product[]; - список товаров в корзине
- `total`: number; - общая сумма товаров
## -------------------

**Интерфейс данных заказа. 1 шаг. IOrderChange**.
Данные, которые посылаются вместе с событием CheckoutEvent.ORDER_CHANGED.

***Поля***:
- `payment?`: Payment; - Выбранный способ оплаты. Может отсутствовать, если пользователь его ещё не указал.
- `address`: string; - адрес доставки
- `valid`: boolean; - Флаг, указывающий валидны ли оба поля..
- `error`: string; - Сообщение об ошибке.

## -------------------

**Интерфейс данных заказа. 2 шаг. IContactsChange**.
Данные, которые посылаются вместе с событием CheckoutEvent.CONTACTS_CHANGED.

***Поля***:
- `email`: string; - Email пользователя.
- `phone`: string; - телефон пользователя.
- `valid`: boolean; - Флаг, указывающий валидны ли оба поля.
- `error`: string; - Сообщение об ошибке.

## -------------------
**Интерфейс успешного заказа. ISuccess**.
Данные, которые посылаются вместе с событием SuccessEvent.CHANGED.

***Поля***:
- `total` - Сумма заказа.

## -------------------

***Интерфейс IEvents***
Типизированный контракт для брокера событий (EventEmitter), включая методы подписки, отписки, вызова и генерации событий.

***Методы***:
- `on<T extends object>(event: EventName, callback: (data: T) => void): void;` - Подписка на событие по имени или шаблону
- `emit<T extends object>(event: string, data?: T): void;` - Вызывает всех соответствующих подписчиков.
- `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;` - Создаёт функцию-триггер, которая генерирует событие при вызове

***Алиасы типов***
- `type EventName = string | RegExp` - Имя события. Может быть строкой или регулярным выражением для шаблонной подписки.
- `type Subscriber = Function` - Тип любого обработчика события (подписчика).
- `type EmitterEvent = { eventName: string; data: unknown }` - Тип данных, передаваемых в обработчик при глобальной подписке через onAll.
  Содержит имя события и переданные данные.



## -------------------
***Интерфейс ICard***
Определяет структуру данных, которые принимает метод render:

- `counter: number` — количество товаров в корзине;

- `catalog: HTMLElement[]` — список DOM-элементов каталога;

- `locked: boolean` — флаг блокировки страницы (например, при открытии модального окна).

## -------------------
***Интерфейс IPageActions***
Определяет список доступных действий, передаваемых в конструктор:

- `onBasketClick(event: MouseEvent): void` — обработчик клика по иконке корзины.

## -------------------

***Интерфейс ICard***
Определяет структуру данных, которые принимает метод render:

- `id: string` — уникальный идентификатор товара;

- `category: ProductCategory` — категория товара ('софт-скил', 'хард-скил', 'дополнительное', 'кнопка', и др.);

- `title: string` — заголовок карточки;

- `image: string` — путь к изображению;

- `price: number | null` — цена в синапсах или null, если "бесценно";

- `description: string` — описание товара.

## -------------------
 ***Интерфейс ICardActions***
Объект с действиями, передаваемый в конструктор:

- `onClick(event: MouseEvent): void` — обработчик клика по карточке или кнопке.


## -------------------
## Модели данных:

Класс **Catalog**

Наследуется от абстрактной модели данных AModel. Сообщает всем подписчикам, что товары пришли с сервера и наш каталог товаров изменился.

***Поля***:
Не имеет.


***Конструктор***: 
Наследует от абстрактной модели данных AModel.


***Методы***:  

- `setProducts` - оповещает всех подписчиков об изменении каталога товаров;
Принимает параметром массив товаров, которые пришли с сервера.

## -------------------

Класс **Basket**

Модель данных корзины интернет-магазина.
Реализует хранение товаров и управление товарами в корзине.
Наследуется от абстрактной модели данных AModel.
Имеет событийную модель для уведомления подписчиков об изменениях.


***Поля***:
- `products` хранит массив товаров типа Product[].
- 
***Конструктор***:
  Наследует конструктор от абстрактной модели данных AModel.

***Методы***:
- `getProducts` - Возвращает массив объектов товаров типа Product[]. 
- `getTotal` - Возвращает сумму цен товаров в корзине типа number.
- `add` - Метод принимает параметр product типа Product. Добавляет товар в корзину, конкретно в наш массив, в поле products
и сообщает об изменениях подписчикам.
- `remove` - Метод принимает параметр product типа Product. Удаляет товар из корзины, конкретно из нашего массива, в поле products
    и сообщает об изменениях подписчикам.
- `clear` - Удаляет все товары из корзины, очищает наш массив в поле products.
  и сообщает об изменениях подписчикам.
- `changed` - Внутренний метод, вызываемый после каждого изменения. Генерирует событие CHANGED с актуальными данными корзины.
## -------------------

Класс **Order**
Модель данных заказа товаров. 1 шаг.

Реализует хранение данных о выбранном способе оплаты и адресе.
Наследуется от абстрактной модели данных AModel.

***Поля***:
- `_payment` хранит способ оплаты выбранный пользователем типа Payment = 'card' | 'cash';.
- `_address` хранит адрес пользователя типа string, изначально пустая строка.

***Конструктор***:
Наследует конструктор от абстрактной модели данных AModel.

***Методы***:
- `getPayment` - Возвращает способ оплаты, выбранный пользователем типа Payment. Может не иметь значения.
- `getAddress` - Возвращает адрес, введенный пользователем типа string.
- `setPayment` - Принимаем параметром способ оплаты, типа Payment. Добавляет его в поле _payment. Сообщает подписчикам об изменениях.
- `getValid` - Возвращает true или false типа boolean, если пользователь выбрал способ оплаты и ввел адрес.
- `setAddress` - Принимает адрес типа string, введенный пользователем. Добавляет его в поле _address. Сообщает подписчикам об изменениях.
- `getError` - Возвращает первую подходящую ошибку типа string если не выбран способ оплаты и не заполнено поле с адресом.
- `orderChanged` - Внутренний метод, вызываемый после каждого изменения. Генерирует событие ORDER_CHANGED с актуальными данными заказа.

## -------------------
Класс **Contacts**
Модель данных заказ товаров. 2 шаг.

Реализует хранение данных Email и телефон.
Наследуется от абстрактной модели данных AModel.

***Поля***:
- `_email` - хранит email пользователя типа string, изначально пустая строка.
- `_phone` - хранит телефон пользователя типа string, изначально пустая строка.

***Конструктор***:
Наследует конструктор от абстрактной модели данных AModel.

***Методы***:

- `getEmail` - Возвращает Email, введенный пользователем типа string.
- `getPhone` - Возвращает телефон, введенный пользователем типа string.
- `setEmail` - Принимает Email типа string, введенный пользователем. Добавляет его в поле _email. Сообщает подписчикам об изменениях.
- `setPhone` - Принимает телефон типа string, введенный пользователем. Добавляет его в поле _phone. Сообщает подписчикам об изменениях.
- `contactsChanged` - Внутренний метод, вызываемый после каждого изменения. Генерирует событие CONTACTS_CHANGED с актуальными данными заказа.
- `getValid` - Проверяет, заполнены ли оба поля — email и телефон.
- `getError` - Возвращает первую подходящую ошибку типа string если не заполнено поле c телефоном или с Email.
## -------------------

Класс **Success**
Модель данных успешного заказа.
Реализует хранение данных суммы заказа.
Наследуется от абстрактной модели данных AModel.

***Поля***:
- `total` - хранит сумму заказа. Тип number. Изначально равен 0.

***Конструктор***: Не имеет.
***Методы***:
- `setTotal` - Принимает сумму заказа типа number. Добавляет его в поле total. Сообщает подписчикам об изменениях: вызывает событие SuccessEvent.CHANGED

## -------------------
Класс **LarekApi**
Модель данных, которая передаёт и получает данные от сервера.
Наследуется от абстрактной модели данных Api.

***Поля***:
- `cdn` - Базовый URL CDN, добавляемый к путям изображений товаров типа string.


***Конструктор***:
Создаёт экземпляр API-клиента. Принимает параметры:
- `cdn` - типа string. адрес CDN для подстановки к полям image у товаров.
- `baseUrl` - типа string. Базовый URL API.
- `options` - типа RequestInit. Необязательные параметры запроса.

***Методы***:
- `getProductItem` - Принимает айди товара типа string. Возвращает объект Product с добавленным полным URL изображения.
- `getProductList` - Возвращает массив типа Product[] с URL изображения.
- `orderProducts` - Принимает объект типа IOrder. Возвращает результат оформления заказ OrderResult.




## -------------------



## Модели отображения

Позволяют отображать элементы страницы с полученными данными, позволяют взаимодействовать с пользователем.

Класс **Page**
Отвечает за отображение главной страницы приложения.
Наследуется от базового класса AView и реализует отрисовку счетчика корзины, каталога и состояния блокировки страницы.

***Конструктор***:

Создаёт экземпляр страницы.
Принимает параметры:
container: HTMLElement — DOM-элемент, в который будет отрисована страница.
actions: IPageActions — объект с колбэком onBasketClick.

Во время инициализации: выбираются элементы .page__wrapper, .header__basket-counter, .gallery, .header__basket с помощью ensureElement;
назначается обработчик клика на иконку корзины.

***Поля***:
- `wrapper: HTMLElement` —обёртка страницы (.page__wrapper);

- `counter: HTMLElement` — элемент с количеством товаров в корзине (.header__basket-counter);

- `catalog:HTMLElement` — контейнер для карточек каталога (.gallery);

- `basket:HTMLElement` — иконка корзины (.header__basket).

***Методы***:
- `doRender(data: Partial<IPage>): void` — Метод, реализующий отрисовку страницы на основе переданных данных.

Обновляет:
счётчик корзины;
список товаров;
состояние блокировки страницы.

- `setLocked(value: boolean): void` — Добавляет или убирает класс page__wrapper_locked у обёртки страницы.
value — true блокирует страницу, false — разблокирует.

***Используемая утилита***
- `ensureElement<T>(selector: string, parent?: HTMLElement): T` — утилита для безопасного получения элемента по селектору. Выбрасывает ошибку, если элемент не найден. Позволяет избежать null и работать с DOM безопасно
## -------------------
Класс **Card**

Отвечает за отображение карточки товара на странице. Наследуется от AView и реализует базовую логику отображения данных о товаре: заголовок, изображение, категорию, цену, описание и кнопку.

***Поля***:
- `category:HTMLElement` — DOM-элемент категории.
- `title: HTMLElement` — заголовок.
- `image: HTMLImageElement` — .
- `price: HTMLElement` — изображение товара.
- `description: HTMLElement | null` — цена.
- `button: HTMLButtonElement | null` — кнопка (если есть).

***Конструктор***:

- `constructor(protected container: HTMLElement, actions?: ICardActions)`
  Инициализирует все элементы карточки: .card__category, .card__title, .card__image, .card__price, .card__text, .card__button.
Если передан onClick, добавляет обработчик: если есть кнопка — на кнопку; если кнопки нет — на всю карточку.


***Методы***:
- `doRender(data: Partial<RenderData>): void` — Обновляет контент карточки: Заголовок; Картинку и alt-текст; Категорию и соответствующий класс; Цена: "бесценно" или в синапсах; Описание.

- `setProductCategory(value: ProductCategory): void` — Устанавливает текст и класс категории, например:
'хард-скил' → card__category _hard
'софт-скил' → card__category _soft

- `getProductCategoryClass(value: string): string` — Возвращает соответствующий CSS-класс в зависимости от значения категории.

- `setProductPrice(price: number | null): void` — Если цена null → выводит "Бесценно",
иначе — выводит ${price} синапсов.

- `setProductDescription(value: string): void` — Обновляет описание, если элемент существует.

***Используемая утилита***

- `ensureElement<T>(selector: string, parent?: HTMLElement): T` — безопасно получает элемент по селектору или выбрасывает ошибку, если не найден.
## -------------------

Класс **Modal** управляет модальными окнами.
Методы:
- `open` - отображает модальное окно.
- `close` - закрывает модальное окно.

Класс **Success** для отображения успешного заказа.
Методы:
- `setTotal` - передаёт количество списанных синапсов.

Класс **MiniCart** отвечает за миниатюрную корзину в хедере.
- `setCount` - устанавливает какое количество товаров находится в корзине.

Класс **Cart** для отображения корзины.
Методы:
- `setProduct` - передаёт список товаров в корзину

Класс **CartItem** для отображения карточки товара в корзине.
Методы:
- `setProduct` - передаёт товар
- `setIndex` - передаёт порядковый номер товара

Класс **ProductCard** для отображения карточки товара на веб странице.
Методы:
- `setProduct` - передаёт товар
- `setCategory` - передаёт категорию товара

Класс **ProductCardPreview** для отображения модального окна товара
Методы:
- `setProduct` - передаёт товар
- `setCategory` - передаёт категорию товара

Класс **CheckoutPaymentAddress** для отображения метода оплаты и адреса, принимает соответствующие данные от пользователя.

Класс **CheckoutContacts** для отображения email и телефона, принимает соответствующие данные от пользователя.

## События

###  Инициализация
- `products:ready` - данные товаров загружены и готовы отправиться в отображения

### Модальные окна
- `modal:productPreview` - открытие модального окна товара
- `modal:basket` - открытие модального окна корзины
- `modal:checkout:paymentAddress` - открытие модального окна оформления заказа с выбором оплаты и полем адреса
- `modal:checkout:contacts` - открытие модального окна оформления заказа с полями email и телефона
- `modal:checkout:success` - открытие модального окна успешного заказа
- `modal:close` - закрытие модального окна

### Корзина
- `basket:add` - добавление товара в корзину
- `basket:remove` - удаление товара из корзины
- `basket:clear` - очистка корзины
- `basket:changed` - изменение состава корзины

### Оформление заказа
- `checkout:payment` - выбор способа оплаты
- `checkout:address` - заполнение адреса
- `checkout:proceed` - переход к шагу с телефоном и эмейлом
- `checkout:phone` - заполнение телефона
- `checkout:email` - заполнение эмейла
- `checkout:place` - создание заказа